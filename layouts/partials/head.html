{{ .Site.Params.headercommentblock | safeHTML }}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>{{ block "title" . }}
        {{ .Title }}
        {{ end }}
    </title>
    {{ $description := .Description | default .Site.Params.description | default (printf "%s - Temporal Interference brain stimulation technology for tomorrow's treatments" .Site.Title) }}
    <meta name="description" content="{{ $description | strings.TrimSuffix "\n" | htmlEscape }}">

    {{/* Check if UIKit submodule is initialized */}}
    {{ $uikitCheck := resources.Get "uikit/package.json" }}
    {{ if not $uikitCheck }}
        {{ errorf "\n\n‚ùå UIKit submodule not initialized!\n\nThe z43-cards-theme requires UIKit to be initialized.\n\nTo fix this, run:\n  bash \"$(hugo config mounts | jq -rs '.[] | select(.path | contains(\"z43-cards-theme\")) | .dir')/init-theme.sh\"\n\nOr if you cloned the theme directly:\n  git submodule update --init --recursive\n\nSee https://github.com/temporalinterference/z43-cards-theme#installation for details.\n" }}
    {{ end }}

    {{ $sass := resources.Get "scss/theme.scss" }}
    {{ $customScss := resources.Get "scss/custom.scss" }}
    {{ $style := "" }}
    {{ $sassOpts := dict "transpiler" "dartsass" "targetPath" "css/main.css" "includePaths" (slice "assets" "assets/uikit/src" "assets/uikit") }}
    {{ if $customScss }}
    {{ $sassHash := sha256 $sass.Content }}
    {{ $customHash := sha256 $customScss.Content }}
    {{ $combinedHash := printf "%s-%s" $sassHash $customHash }}
    {{ $sassProcessed := $sass | resources.ExecuteAsTemplate (printf "theme-%s.scss" $sassHash) . }}
    {{ $customProcessed := $customScss | resources.ExecuteAsTemplate (printf "custom-%s.scss" $customHash) . }}
    {{ $combinedScss := printf "%s\n\n%s" $sassProcessed.Content $customProcessed.Content }}
    {{ $style = ($combinedScss | resources.FromString (printf "combined-%s.scss" $combinedHash)) | toCSS $sassOpts | minify | fingerprint }}
    {{ else }}
    {{ $style = $sass | resources.ExecuteAsTemplate "main.scss" . | toCSS $sassOpts | minify | fingerprint }}
    {{ end }}
    {{ $secureStyle := $style | resources.Fingerprint "sha512" }}
    <link rel="stylesheet" href="{{ $style.RelPermalink }}" integriety="{{ $style.Data.Integrity }}">
    {{ $js := resources.Get "uikit/dist/js/uikit.min.js" }}
    {{ $secureJS := $js | resources.Fingerprint "sha512" }}
    <script src="{{ $js.RelPermalink }}" integrity="{{ $secureJS.Data.Integrity }}"></script>
    {{ $jsIcons := resources.Get "uikit/dist/js/uikit-icons.min.js" }}
    {{ $secureJsIcons := $jsIcons | resources.Fingerprint "sha512" }}
    <script src="{{ $jsIcons.RelPermalink }}" integrity="{{ $secureJsIcons.Data.Integrity }}"></script>
    {{ $customJs:= resources.Get "js/custom.js" }}
    {{ $secureCustomJs := $customJs | resources.Fingerprint "sha512" }}
    <script src="{{ $customJs.RelPermalink }}" integrity="{{ $secureCustomJs.Data.Integrity }}"></script>
    {{ $favicon := $.Site.Params.favicon }}
    {{ if $favicon }}
    {{ $faviconPng := resources.Get (print "images/" $favicon ".png") }}
    {{ $faviconSvg := resources.Get (print "images/" $favicon ".svg") }}
    {{ if $faviconPng }}
    <link rel="icon" href='{{ $faviconPng.RelPermalink }}' sizes="any">
    {{ end }}
    {{ if $faviconSvg }}
    <link rel="icon" href='{{ $faviconSvg.RelPermalink }}' type="image/svg+xml">
    {{ end }}
    {{ end }}
</head>
